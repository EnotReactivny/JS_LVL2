"use strict";function Container(){this.id="",this.className="",this.htmlCode="123"}function Basket(){Container.call(this),this.id="basket",this.count_goods=0,this.amount=0,this.basket_items=[],this.collectBasketItems()}Container.prototype.render=function(){return this.htmlCode},Basket.prototype=Object.create(Container.prototype),Basket.prototype.constructor=Basket,Basket.prototype.render=function(t){var e=$("<div/>",{id:this.id,text:"Корзина"});$("<div/>",{id:this.id+"_items"}).appendTo(e),e.appendTo(t)},Basket.prototype.collectBasketItems=function(){var t="#"+this.id+"_items";$.get({url:"http://localhost:8080/basket/1",context:this,success:function(e){var i=this,o=$("<div/>",{id:"basket_data"});e.basket.map(function(t){i.count_goods+=t.quantity}),this.amount=e.full_price,o.append("<p>Всего товаров: "+this.count_goods+"</p>"),o.append("<p>Сумма: "+this.amount+"</p>"),o.appendTo(t),e.basket.map(function(t,e){i.basket_items.push(t)})},dataType:"json"})},Basket.prototype.add=function(t,e,i){var o={id_product:t,price:i,quantity:e};$.post({url:"http://localhost:8080/basket/1",context:this,headers:{Accept:"application/json","Content-Type":"application/json"},data:JSON.stringify(o),success:function(e){console.log(o);var s=0,n={id_product:t,price:i};e.basket.map(function(t){s+=t.quantity}),this.count_goods=s,this.amount=e.full_price,this.basket_items.push(n),$("<div/>",{id:"rem_"+t,class:"removeItem",text:"Удалить продукт id - "+t}).appendTo("#basket_items"),this.refresh()},error:function(t,e,i){console.log(e,t)}})},Basket.prototype.delete=function(t,e,i){var o={id_product:t,price:i,quantity:e};$.post({url:"http://localhost:8080/basket/1/delete",context:this,headers:{Accept:"application/json","Content-Type":"application/json"},data:JSON.stringify(o),success:function(e){console.log(e);var o=0,s={id_product:t,price:i};console.log("basket_item: ",s),e.basket.map(function(t){o+=t.quantity}),this.count_goods=o,this.amount=e.full_price,$("#rem_"+t).remove(),this.refresh()},error:function(t,e,i){console.log(e,t)}})},Basket.prototype.refresh=function(t){var e=$("#basket_data");e.empty(),e.append("<p>Всего товаров: "+this.count_goods+"</p>"),e.append("<p>Сумма: "+this.amount+"</p>")},$(document).ready(function(){var t=new Basket;t.render("#basket_wrapper");var e=new Review;e.render(),$(".buyme").on("click",function(){var e=parseInt($(this).attr("id").split("_")[1]),i=parseInt($(this).parent().find(".product-price").text());t.add(e,1,i)}),$(document).on("click",".removeItem",function(){var e=parseInt($(this).attr("id").split("_")[1]),i=parseInt($("#good_"+e).parent().find(".product-price").text()),o=i;t.delete(e,1,o)}),$("form").submit(function(){var t=parseInt($(this).attr("id").split("_")[1]),i=parseInt($(this).attr("id").split("_")[1]),o=$("#inputRev_"+i).val(),s=$("<div/>",{id:"approve_"+i}),n=$("<button/>",{id:"approveButton_"+i,class:"app",text:"Опубликовать отзыв"}),a=$("<div/>",{id:"reviewPublic_"+i});return this.before(a[0]),this.after(s[0]),s[0].after(n[0]),e.addReview(t,i,1,o),!1}),$(document).on("click",".app",function(){var t=parseInt($(this).attr("id").split("_")[1]),i="reviewPublic_"+t;e.getReview(i,t);var o="#approveButton_"+t;$(o).remove()}),$(document).on("click",".delReview",function(){var t=parseInt($(this).parent().attr("class").split("_")[1]),i="#reviewPublic_"+t;$(i).remove(),e.delete(t),console.log(t)})});